{extend name="common@public/base"/}
{block name="style"}
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/libs/bootstrap-editable.css">
{/block}
{block name="body"}
<section class="content-header">
    <h1>{$meta_title}<small></small></h1>
    <ol class="breadcrumb">
        <li><a href="{:url('admin/index/index')}"><i class="fa fa-dashboard"></i> {:lang('console')}</a></li>
        {volist name="__menu__['parent']" id="pitem"}
        <li class="{$pitem.action}">{if condition="$pitem.action eq ''"}<a href="{$pitem.url|url}" > {$pitem.title}</a>{else/} {$pitem.title}{/if}</li>
        {/volist}
    </ol>
</section>
<section class="content">
    <div class="box box-solid clearfix">
        <!--body begin-->
        <div class="box-body clearfix">
            <!--tabs-custom begin-->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    {if condition='$take_over.have_config eq 1'}
                    <li class="active">
                        <a href="#tab_1-1"  class="device_group" role="tab" data-toggle="tab"  >{:lang('take_over')}</a>
                    </li>
                    {/if}
                    {if condition='$exercise.have_config eq 1'}
                    <!--<li class="">-->
                        <!--<a href="#tab_1-2"  class="device_group" role="tab" data-toggle="tab" >{:lang('exercise')}</a>-->
                    <!--</li>-->
                    {/if}
                    <li class="pull-right header">
                        {if condition='$take_over.have_config eq 1'}
                        <a class="badge bg-light-blue" style="display:inline" href="javascript:" data_role="edit_takeover_conf" config-type="0" >{:lang('edit')}{:lang('take_over')}{:lang('config')}</a>
                        {else/}
                        <a class="badge bg-light-blue" style="display:inline" href="javascript:" data_role="add_auto_conf" config-type="0" >{:lang('add_take_over')}</a>
                        {/if}
                        {if condition='$exercise.have_config eq 1'}
                        <!--<a class="badge bg-light-blue" style="display:inline" href="javascript:" data_role="edit_exercise_conf" config-type="1">{:lang('edit')}{:lang('exercise')}{:lang('config')}</a>-->
                       {else/}
                        <!--<a class="badge bg-light-blue" style="display:inline" href="javascript:" data_role="add_auto_conf" config-type="1">{:lang('add_exercise')}</a>-->
                       {/if}
                        <a class="badge bg-light-blue go-back" style="display:inline" href="{:url('manage/device')}" >{:lang('back')}</a>
                    </li>
                </ul>
                {if condition='$take_over.have_config eq 1 || $exercise.have_config eq 1'}
                <!--content begin-->
                <div class="tab-content">
                    <!--接管begin-->
                    <div class="tab-pane active" id="tab_1-1">
                        <ul class="list-group col-md-6 col-xs-12" style="line-height:20px;margin-bottom:0; padding-right:0;">
                            <li class="list-group-item info-box-text">{:lang('device')}IP：{$take_over['config']['device_name']}({$take_over['config']['device_ip']})</li>
                            <li class="list-group-item info-box-text">{:lang('compute_pool')}IP：{$take_over['config']['compute_ip']}</li>
                            <li class="list-group-item info-box-text">{:lang('type')}：{$take_over['config']['type_alias']}</li>
                            <li class="list-group-item info-box-text">{:lang('system')}{:lang('type')}：{$take_over['config']['system_type_alias']}</li>
                        </ul>
                        <ul class="list-group col-md-6 col-xs-12" style="line-height:20px;margin-bottom:0; padding-right:0">
                            <li class="list-group-item info-box-text">{:lang('cpu')}：{$take_over['config']['cpu']}</li>
                            <li class="list-group-item info-box-text">{:lang('memory')}：{$take_over['config']['memory']}</li>
                            <li class="list-group-item info-box-text">{:lang('net_work')}：{$take_over['config']['network']}个</li>
                            <li class="list-group-item info-box-text">{:lang('state')}:
                                {if $take_over['config']['status']}
                                <span class="label label-success">{:lang('enable')}</span>
                                {else/}
                                <span class="label label-danger">{:lang('disable')}</span>
                                {/if}
                            </li>
                        </ul>
                    </div>
                 <!--接管end-->

                    <!--演练begin-->
                    <div class="tab-pane" id="tab_1-2">
                        <ul class="list-group col-md-6 col-xs-12" style="line-height:20px;margin-bottom:0; padding-right:0;">
                            <li class="list-group-item info-box-text">{:lang('device')}IP：{$exercise['config']['device_name']}({$exercise['config']['device_ip']})</li>
                            <li class="list-group-item info-box-text">{:lang('compute_pool')}IP：{$exercise['config']['compute_ip']}</li>
                            <li class="list-group-item info-box-text">{:lang('type')}：{$exercise['config']['type_alias']}</li>
                            <li class="list-group-item info-box-text">{:lang('system')}{:lang('type')}：{$exercise['config']['system_type_alias']}</li>
                            <li class="list-group-item info-box-text">{:lang('state')}:
                                {if $exercise['config']['status']}
                                <span class="label label-success">{:lang('enable')}</span>
                                {else/}
                                <span class="label label-danger">{:lang('disable')}</span>
                                {/if}
                            </li>
                            </li>
                        </ul>
                        <ul class="list-group col-md-6 col-xs-12" style="line-height:20px;margin-bottom:0; padding-right:0">
                            <li class="list-group-item info-box-text">{:lang('cpu')}：{$exercise['config']['cpu']}</li>
                            <li class="list-group-item info-box-text">{:lang('memory')}：{$exercise['config']['memory']}</li>
                            <li class="list-group-item info-box-text">{:lang('net_work')}：{$exercise['config']['network']}个</li>
                            <li class="list-group-item info-box-text">{:lang('duration')}：每周{$exercise['config']['day_alias']} {$exercise['config']['accurate_time_alias']}
                        </ul>
                    </div>
                    <!--演练end-->


                    <!--日志信息 begin-->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <i class="fa fa-bar-chart-o"></i>
                                    <h3 class="box-title">{:lang('log_info')}</h3>
                                    <div class="box-tools pull-right">
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div id="monitor_system" style=""></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--日志信息end-->
                </div>
                {else/}
                <div class="row">
                    <div class="col-lg-12">
                           <h4 style="text-align: center">暂无任何相关配置信息</h4>
                    </div>
                </div>
                {/if}
                <!--content end-->
            </div>
             <!--tab custom end-->
        </div>
        <!--body end-->
    </div>
</section>

<!--自动化配置 新增 模态框-->
<div class="modal" id="add_auto_conf">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="modal_hidden">&times;</span></button>
                <h4 class="modal-title"></h4>
            </div>
            <form class="form form-horizontal instead_host" role="form" method="post" action="{:url('cdp/index/add_auto_config')}">
                <input type="hidden" name='device_id' value="{$device_id}">
                <input type="hidden" name="type" value="-1" id="config-type">
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('is_use')}</label>
                        <div class="col-sm-10">
                            <div class="">
                                <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="1" checked>{:lang('use')}</div>
                                <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="0" >{:lang('not_use')}</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('compute_snap')}</label>
                        <div class="col-sm-6">
                            <select id='computing' name='compute_id' class="form-control select2" style="width:100%">
                                <option value="{$best_id}">自动分配</option>
                                {volist name="computing_list" id="vo_comp"}
                                <option value="{$vo_comp['id']}" max_cpu="{$vo_comp['max_cpu']}" >{$vo_comp['name']}({$vo_comp['ip']}) </option>
                                {/volist}
                            </select>
                        </div>
                    </div>

                    <div class="form-group exercise-hidden" style="margin-top:40px;" >
                        <label class="col-sm-2 control-label">星期</label>
                        <div class="col-sm-8">
                            <!--<input  name="day" type="text" value="1" class="slider form-control auto_day" data-slider-min="1" data-slider-max="7" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">-->
                            <input  type="checkbox" name="week[]" value="1">  周一
                            <input  type="checkbox" name="week[]" value="2">  周二
                            <input  type="checkbox" name="week[]" value="3">  周三
                            <input  type="checkbox" name="week[]" value="4">  周四
                            <input  type="checkbox" name="week[]" value="5">  周五
                            <input  type="checkbox" name="week[]" value="6">  周六
                            <input  type="checkbox" name="week[]" value="7">  周日

                        </div>
                    </div>

                    <div class="form-group exercise-hidden" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">精确时间</label>
                        <div class="col-sm-8">
                            <input  name="time" type="text" value="1" class="slider form-control auto_time" data-slider-min="0" data-slider-max="86400" data-slider-step="1800" data-slider-value="0" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">CPU</label>
                        <div class="col-sm-8">
                            <input name="cpu_kernel" type="text" value="1" class="slider form-control skvhostcpuS1" data-slider-min="1" data-slider-max="10" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">{:lang('memory')}</label>
                        <div class="col-sm-8">
                            <input  name="memory" type="text" value="512" class="slider form-control skvhostmemoryS1" data-slider-min="512" data-slider-max="2048" data-slider-step="512" data-slider-value="16384" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:20px;">
                        <label class="col-sm-2 control-label">{:lang('username')}</label>
                        <div class="col-sm-5">
                            <input class="form-control"  type="text" name="username" placeholder="">
                        </div>
                    </div>
                    <div class="form-group" style="margin-top:10px;">
                        <label class="col-sm-2 control-label">{:lang('password')}</label>
                        <div class="col-sm-5">
                            <input class="form-control" type="text" name="password">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('network_adapter')}</label>
                        <div class="col-sm-10" id="net_html">
                            {volist name="hardware_info.netcards" id='item' key='k'}
                            <div  class="row network" style="margin-bottom:5px; padding-left:15px" id="data_net_index_{$k-1}">
                                <div class="col-sm-2 no-padding text-center" style="line-height:32px;border:1px #ccc solid;border-right:0"> 网卡{$k} </div>
                                <div class="col-sm-3 no-padding">
                                    <input name="netdata[{$k-1}][ip]" type="text" value="{$item['ip']}" class="form-control">
                                </div>
                                <div class="col-sm-4 no-padding">
                                    <input name="netdata[{$k-1}][mac]" type="text" value="{$item['mac']}" dataindex="{$k-1}" data_role_mac="" class="form-control net_mac">
                                </div>
                                <div class="col-sm-2 no-padding">
                                    <select name="netdata[{$k-1}][type]" class="modelselect form-control net_mac_model">
                                        <option value="NAT">NAT</option>
                                    </select>
                                </div>
                                <div class="col-sm-1">
                                    <i class="glyphicon glyphicon-trash" data_role="trash_net" data_role_index="{$k-1}"></i>
                                </div>
                                <div class="col-sm-12 no-padding">
                                    <span style="font-size:12px;color:#F00" id="tooltip_1"></span>
                                </div>
                            </div>
                            {/volist}
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-1 control-label"></label>
                        <div class="col-sm-10"><div class="btn btn-success add_net" type='' add-flag="1">{:lang('add_network')}</div></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success ajax-post" target-form="instead_host">{:lang('submit')}</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">{:lang('cancel')}</button>
                </div>
                <input hidden="hidden"  name='system_type'  value="{$client_system}" />
            </form>
        </div>
    </div>
</div>
<!--model end-->



<!--自动化 接管 模态框-->
{if condition="$take_over[have_config] eq 1"}
<div class="modal" id="edit_takeover_conf">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true" class="modal_hidden">&times;</span></button>
            <h4 class="modal-title"><i class="fa fa-exclamation-circle"></i>{:lang('auto_configure')}</h4>
        </div>
        <form class="form form-horizontal edit-takeover-config" role="form" method="post" action="{:url('cdp/index/edit_auto_config')}">
            <input type="hidden" name="config_id" value="{$take_over['config']['id']}">
            <div class="modal-body">

                <div class="form-group">
                    <label class="col-sm-2 control-label">{:lang('is_use')}</label>
                    <div class="col-sm-10">
                        <div class="">
                            <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="1" <?php if($take_over['config']['status']==1) echo 'checked';s ?>>{:lang('use')}</div>
                            <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="0" <?php if($take_over['config']['status']!=1) echo 'checked';s ?>>{:lang('not_use')}</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">{:lang('compute_snap')}</label>
                    <div class="col-sm-6">
                        <select  name='compute_id' class="form-control select2" style="width:100%">
                            {volist name="computing_list" id="vo_comp"}
                            <?php if($vo_comp['id']==$take_over['config']['compute_id'])
                                       { $str = 'selected="selected"';}else{
                                         $str = '';
                                       }
                                ?>
                            <option value="{$vo_comp['id']}" {$str} >{$vo_comp['name']}({$vo_comp['ip']}) </option>
                            {/volist}
                        </select>
                    </div>
                </div>


                <div class="form-group" style="margin-top:40px;">
                    <label class="col-sm-2 control-label">CPU</label>
                    <div class="col-sm-8">
                        <input id="edit_takeover_skvhostcpuS1" name="cpu_kernel" type="text" value="{$take_over['config']['cpu']}" class="slider form-control " data-slider-min="1" data-slider-max="10" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                    </div>
                </div>

                <div class="form-group" style="margin-top:40px;">
                    <label class="col-sm-2 control-label">{:lang('memory')}</label>
                    <div class="col-sm-8">
                        <input  id='edit_takeover_skvhostmemoryS1' name="memory" type="text" value="{$take_over['config']['memory']}" class="slider form-control " data-slider-min="512" data-slider-max="2048" data-slider-step="512" data-slider-value="16384" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                    </div>
                </div>

                <div class="form-group" style="margin-top:20px;">
                    <label class="col-sm-2 control-label">{:lang('username')}</label>
                    <div class="col-sm-5">
                        <input class="form-control"  type="text" name="username" value="{$take_over['config']['username']}" placeholder="">
                    </div>
                </div>
                <div class="form-group" style="margin-top:10px;">
                    <label class="col-sm-2 control-label">{:lang('password')}</label>
                    <div class="col-sm-5">
                        <input class="form-control" type="text" value="{$take_over['config']['password']}" name="password">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">{:lang('network_adapter')}</label>
                    <div class="col-sm-10" id="edit_takeover_net">
                        {volist name="$take_over.config.netdata" id='item' key='k'}
                        <div  class="row network" style="margin-bottom:5px; padding-left:15px" id="data_net_index_{$k-1}">
                            <div class="col-sm-2 no-padding text-center" style="line-height:32px;border:1px #ccc solid;border-right:0"> 网卡{$k} </div>
                            <div class="col-sm-3 no-padding">
                                <input name="netdata[{$k-1}][ip]" type="text" value="{$item['ip']}" class="form-control">
                            </div>
                            <div class="col-sm-4 no-padding">
                                <input name="netdata[{$k-1}][mac]" type="text" value="{$item['mac']}" dataindex="{$k-1}" data_role_mac="" class="form-control net_mac">
                            </div>
                            <div class="col-sm-2 no-padding">
                                <select name="netdata[{$k-1}][type]" class="modelselect form-control net_mac_model">
                                    <option value="{$item['type']}">{$item['type']}</option>
                                </select>
                            </div>
                            <div class="col-sm-1">
                                <i class="glyphicon glyphicon-trash" data_role="trash_net" data_role_index="{$k-1}"></i>
                            </div>
                            <div class="col-sm-12 no-padding">
                                <span style="font-size:12px;color:#F00" id="tooltip_1"></span>
                            </div>
                        </div>
                        {/volist}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label"></label>
                    <div class="col-sm-10"><div class="btn btn-success add_net" type="0">{:lang('add_network')}</div></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success ajax-post" target-form="edit-takeover-config">{:lang('submit')}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{:lang('cancel')}</button>
            </div>
            <input hidden="hidden"  name='system_type'  value="{$client_system}" />
        </form>
    </div>
</div>
</div>
{/if}
<!--model end-->

<!--自动化 演练 模态框-->
{if condition="$exercise[have_config] eq 1"}
<div class="modal" id="edit_exercise_conf">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="modal_hidden">&times;</span></button>
                <h4 class="modal-title"><i class="fa fa-exclamation-circle"></i>{:lang('auto_configure')}</h4>
            </div>
            <form class="form form-horizontal edit-exercise-config" role="form" method="post" action="{:url('cdp/index/edit_auto_config')}">
                <input type="hidden" name="config_id" value="{$exercise['config']['id']}">
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('is_use')}</label>
                        <div class="col-sm-10">
                            <div class="">
                                <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="1" <?php if($exercise['config']['status']==1) echo 'checked';s ?>>{:lang('use')}</div>
                                <div class="checkbox-inline no-padding"><input class="vir_type gl_checkbox" type="radio" name='status' value="0" <?php if($exercise['config']['status']!=1) echo 'checked';s ?>>{:lang('not_use')}</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('compute_snap')}</label>
                        <div class="col-sm-6">
                            <select  class="form-control select2" style="width:100%">
                                {volist name="computing_list" id="vo_comp"}
                                <?php if($vo_comp['id']==$exercise['config']['compute_id'])
                                       { $str = 'selected="selected"';}else{
                                        $str = '';
                                       }
                                ?>
                                <option value="{$vo_comp['id']}" {$str} >{$vo_comp['name']}({$vo_comp['ip']}) </option>
                                {/volist}
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">天</label>
                        <div class="col-sm-8">
                            <input id="edit_exercise_day" name="day" type="text" value="{$exercise['config']['day']}" class="slider form-control " data-slider-min="1" data-slider-max="7" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">精确时间</label>
                        <div class="col-sm-8">
                            <input id="edit_exercise_time" name="time" type="text" value="{$exercise['config']['accurate_time']}" class="slider form-control " data-slider-min="1" data-slider-max="86400" data-slider-step="1" data-slider-value="0" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">CPU</label>
                        <div class="col-sm-8">
                            <input id="edit_exercise_skvhostcpuS1" name="cpu_kernel" type="text" value="{$exercise['config']['cpu']}" class="slider form-control " data-slider-min="1" data-slider-max="10" data-slider-step="1" data-slider-value="1" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:40px;">
                        <label class="col-sm-2 control-label">{:lang('memory')}</label>
                        <div class="col-sm-8">
                            <input  id='edit_exercise_skvhostmemoryS1' name="memory" type="text" value="{$exercise['config']['memory']}" class="slider form-control " data-slider-min="512" data-slider-max="2048" data-slider-step="512" data-slider-value="16384" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="red">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:20px;">
                        <label class="col-sm-2 control-label">{:lang('username')}</label>
                        <div class="col-sm-5">
                            <input class="form-control"  type="text" name="username" value="{$exercise['config']['username']}" placeholder="">
                        </div>
                    </div>
                    <div class="form-group" style="margin-top:10px;">
                        <label class="col-sm-2 control-label">{:lang('password')}</label>
                        <div class="col-sm-5">
                            <input class="form-control" type="text" value="{$exercise['config']['password']}" name="password">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">{:lang('network_adapter')}</label>
                        <div class="col-sm-10" id="edit_exercise_net">
                            {volist name="$exercise.config.netdata" id='item' key='k'}
                            <div  class="row network" style="margin-bottom:5px; padding-left:15px" id="data_net_index_{$k-1}">
                                <div class="col-sm-2 no-padding text-center" style="line-height:32px;border:1px #ccc solid;border-right:0"> 网卡{$k} </div>
                                <div class="col-sm-3 no-padding">
                                    <input name="netdata[{$k-1}][ip]" type="text" value="{$item['ip']}" class="form-control">
                                </div>
                                <div class="col-sm-4 no-padding">
                                    <input name="netdata[{$k-1}][mac]" type="text" value="{$item['mac']}" dataindex="{$k-1}" data_role_mac="" class="form-control net_mac">
                                </div>
                                <div class="col-sm-2 no-padding">
                                    <select name="netdata[{$k-1}][type]" class="modelselect form-control net_mac_model">
                                        <option value="NAT">NAT</option>
                                    </select>
                                </div>
                                <div class="col-sm-1">
                                    <i class="glyphicon glyphicon-trash" data_role="trash_net" data_role_index="{$k-1}"></i>
                                </div>
                                <div class="col-sm-12 no-padding">
                                    <span style="font-size:12px;color:#F00" id="tooltip_1"></span>
                                </div>
                            </div>
                            {/volist}
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-1 control-label"></label>
                        <div class="col-sm-10"><div class="btn btn-success add_net" type="1">{:lang('add_network')}</div></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success ajax-post" target-form="edit-exercise-config">{:lang('submit')}</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">{:lang('cancel')}</button>
                </div>
                <input hidden="hidden"  name='system_type'  value="{$client_system}" />
            </form>
        </div>
    </div>
</div>
{/if}
<!--model end-->


{/block}
{block name="script"}
<script type="text/javascript">


    /*自动化配置*/
    $(document).on('click', '[data_role="add_auto_conf"]', function (e) {
        e.preventDefault();
        var config_type = $(this).attr('config-type');
        if(config_type == 0){
            $('.exercise-hidden').hide();
            $('.modal-title').html('<i class="fa fa-exclamation-circle"></i>'+" {:lang('auto_takeover_configure')}");
            $('.add_net').attr('type',0);
        }else{
            $('.modal-title').html('<i class="fa fa-exclamation-circle"></i>'+" {:lang('auto_exercise_configure')}");
            $('.add_net').attr('type',1);
            $('.exercise-hidden').show();
        }
        $('#config-type').val(config_type);
        $("#add_auto_conf").modal('show')
    })

    $(document).on('click', '[data_role="edit_takeover_conf"]', function (e) {
        e.preventDefault();
        $('.modal-title').html('<i class="fa fa-exclamation-circle"></i>'+" {:lang('auto_takeover_configure')}");
        $("#edit_takeover_conf").modal('show')
    })
    $(document).on('click', '[data_role="edit_exercise_conf"]', function (e) {
        e.preventDefault();
        $('.modal-title').html('<i class="fa fa-exclamation-circle"></i>'+" {:lang('auto_exercise_configure')}");
        $("#edit_exercise_conf").modal('show')
    })


    /*编辑配置*/
    $(document).on('click', '[data_role="edit_auto_conf"]', function (e) {
        e.preventDefault();

        $("#edit_auto_conf").modal('show')
    })

    $(".auto_day").slider({
        tooltip: 'always',
        value:1,
        formatter: function(value) {
            return '星期' + switchDay(value);
        }
    });

    $(".auto_time").slider({
        tooltip: 'always',
        value:1,
        formatter: function(value) {
            return  switchTime(value) ;
        }
    });

    $(".skvhostcpuS1").slider({
        tooltip: 'always',
        value:1,
        formatter: function(value) {
            return 'CPU: ' + value +'个';
        }
    });

    $(".skvhostmemoryS1").slider({
        tooltip: 'always',
        value: 1,
        formatter: function(value) {
            return '内存: ' + value +'MB';
        }
    });



    $("#edit_takeover_day").slider({
        tooltip: 'always',
        value: parseInt("<?php echo $take_over['config']['day']?:1; ?>"),
        formatter: function(value) {
            return '星期' + switchDay(value);
        }
    });

    $("#edit_takeover_time").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $take_over['config']['accurate_time']?:1; ?>"),
        formatter: function(value) {
            return  switchTime(value) ;
        }
    });

    $("#edit_takeover_skvhostcpuS1").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $take_over['config']['cpu']?:1 ;?>"),
        formatter: function(value) {
            return 'CPU: ' + value +'个';
        }
    });

    $("#edit_takeover_skvhostmemoryS1").slider({
        tooltip: 'always',
        value: parseInt("<?php echo $take_over['config']['memory']?:1 ;?>"),
        formatter: function(value) {
            return '内存: ' + value +'MB';
        }
    });
    $("#edit_exercise_day").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $exercise['config']['day']; ?>"),
    formatter: function(value) {
        return '星期' + switchDay(value);
    }
    });

    $("#edit_exercise_time").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $exercise['config']['accurate_time']?:1; ?>"),
    formatter: function(value) {
        return  switchTime(value) ;
    }
    });

    $("#edit_exercise_skvhostcpuS1").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $exercise['config']['cpu']?:1; ?>"),
    formatter: function(value) {
        return 'CPU: ' + value +'个';
    }
    });

    $("#edit_exercise_skvhostmemoryS1").slider({
        tooltip: 'always',
        value:parseInt("<?php echo $exercise['config']['memory']?:1 ?>") ,
            formatter: function(value) {
        return '内存: ' + value +'MB';
    }
    });


    //生成主机名称
    $('#host_name-refresh').click(function(){
        var time = new Date().getTime();
        var time = new Date(time);
        var y = time.getFullYear();
        var m = time.getMonth()+1;
        if (m<10) m = "0"+m;
        var d = time.getDate();
        if (d<10) d = "0"+d;
        var h = time.getHours();
        var mm = time.getMinutes();
        var s = time.getSeconds();
        var name = "Server-"+y+m+d+"-"+h+mm+s;
        $('#skvhostnameS1').val(name);
    });

    $(".modal_hidden").click(function(e){
        e.preventDefault();
        $("#add_virtual").hide();
    });

    $("#host_name-refresh").trigger("click");

    $('.add_net').on('click', function (event) {

        var vir_type_val  = $(this).attr('type');
        var add_flag = $(this).attr('add-flag');

        if(add_flag != 1){
            if(vir_type_val == 1){
               var  add_net_index = $("#edit_exercise_net").children("div.network").length;
            }else if(vir_type_val==0){
               var  add_net_index = $("#edit_takeover_net").children("div.network").length;
            }
        }else{
            var add_net_index = $("#net_html").children("div.network").length;
        }
        var mac_addr = '';
        $.ajax({
            url: '/device/manage/generate_mac_addr',
            type: 'get',
            async: true,
            dataType:'json',
            success: function (res) {
                mac_addr = res.mac_addr;
                var add_html_model = ''
                var add_html = ''
                add_html_model += '<option value=NAT>NAT</option>';
                if (vir_type_val == 1) {
                } else {
                    add_html_model += '<option value="br0" class="model_br">br0</option>';
                }
                add_html += '<div class="row network" style="margin-bottom:5px; padding-left:15px" id="data_net_index_'+add_net_index+'">';
                add_html += '<div class="col-sm-2 no-padding text-center" style="line-height:32px;border:1px #ccc solid;border-right:0"> {:lang("net_work")}'+ (add_net_index+1) +' </div>';
//                add_html += '<div class="col-sm-3 no-padding"><select name="netdata['+add_net_index+'][nic_type]" type="text" value="" class="form-control"><option value="default">default</option><option value="rtl8139">rtl8139</option><option value="e1000">e1000</option><option value="pcnet">pcnet</option><option value="ne2k_pci">ne2k_pci</option><option value="virtio">virtio</option></select></div>';
                add_html += '<div class="col-sm-3 no-padding"><input name="netdata['+add_net_index+'][ip]" type="text" value="" class="form-control"></div>';
                add_html += '<div class="col-sm-4 no-padding"><input name="netdata['+add_net_index+'][mac]" type="text" value="'+mac_addr+'" dataindex="'+ (add_net_index+1) +'"   data_role_mac="" class="form-control net_mac"></div>';
                add_html += '<div class="col-sm-2 no-padding">';
                add_html += '<select name="netdata['+add_net_index+'][type]" class="modelselect form-control net_mac_model">';
                add_html += add_html_model;
                add_html += '</select>';
                add_html += '</div>';
                add_html += '<div class="col-sm-1"><i class="glyphicon glyphicon-trash" data_role="trash_net" data_role_index="'+add_net_index+'" ></i></div>';
                add_html += '<div class="col-sm-12 no-padding"><span style="font-size:12px;color:#F00"  id="tooltip_'+(add_net_index+1)+'"></div>';
                add_html += '</div>';
                add_net_index ++;
                if(vir_type_val == 0 && add_flag != 1){
                    $("#edit_takeover_net").append(add_html);
                }else if(vir_type_val == 1 && add_flag != 1){
                    $("#edit_exercise_net").append(add_html);
                }else{
                    $("#net_html").append(add_html);
                }
            }
        })
    });

    $(document).on("click",'[data_role="trash_net"]',function(e){
        var $this = $(this);
        var data_index = $this.attr('data_role_index');
        $('#data_net_index_'+ data_index).remove();
    });

    $(document).on("blur",'.net_mac',function(e){

        var $this = $(this);
        var data_def_var = $this.attr('data_role_mac');
        var data_index = $this.attr('dataindex');
        var data_var = $this.val();
        if(data_def_var==''){
            $('#tooltip_'+data_index).html('');
        }else{
            if(data_def_var !== data_var){
                if(data_var == ''){
//                    mac地址为空,表示添加新网卡设备,需要进入系统配置网卡信息
                    $('#tooltip_'+data_index).html('');
                }else{
//                    mac地址修改就是删除旧网卡设备，添加新网卡设备，需要进入系统配置网卡信息
                    $('#tooltip_'+data_index).html('');
                }
            }
        }
    });

    $('.vir_type').on('ifClicked', function (event) {
        if ($(this).attr("checked",true)) {
            $(this).iCheck('uncheck');//如果已选择，可以用iCheck取消选择
        } else {
            $(this).iCheck('check');//如果没选择，可以用iCheck美化选择
        }
        var $selectedvalue  = $(this).val();

        if ($selectedvalue == 1) {
            $(".modelselect").html('<option value=NAT>NAT</option>');
        } else {
            var new_net_html = '';
            new_net_html += '<option value="NAT">NAT</option>';

            new_net_html += '<option value="br0" class="model_br">br0</option>';

            $(".modelselect").html(new_net_html);
        }
    });

    $(".select2").select2({
        minimumResultsForSearch: -1
    });

    function switchDay(day){

      var charDays = ['一','二','三','四','五','六','日'];
        return charDays[day-1];
    }
    function switchTime(time){

        var hour = parseInt(time/3600);
        var min = parseInt((time-hour*3600)/60);
        if (hour<10){
            hour = "0"+hour;
        }
        if(min<10){
            min = "0" + min;
        }
        return hour+':'+min;
    }
    $('.go-back').click(function(){
        history.back();
    });

</script>
{/block}